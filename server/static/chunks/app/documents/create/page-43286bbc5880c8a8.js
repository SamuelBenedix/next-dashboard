(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[248],{829:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>S});var s=t(5155),n=t(2115),r=t(5028),i=t(2523),l=t(5617),d=t(7262),o=t(5057),c=t(4991),u=t(4831),h=t(4752),m=t.n(h),f=t(285),g=t(5695),p=t(1154);t(8851),t(2465);var x=t(9409);function j(e){let{data:a,labelKey:t,valueKey:n,placeholder:r="Pilih opsi",onChange:i,filterKey:l,filterExclude:d}=e,o=l&&d?a.filter(e=>e[l]!==d):a;return(0,s.jsxs)(x.l6,{onValueChange:i,children:[(0,s.jsx)(x.bq,{className:"w-full",children:(0,s.jsx)(x.yv,{placeholder:r})}),(0,s.jsx)(x.gC,{children:o.map(e=>(0,s.jsx)(x.eb,{value:String(e[n]),children:String(e[t])},String(e[n])))})]})}let v=(0,r.default)(()=>Promise.all([t.e(464),t.e(360)]).then(t.bind(t,4360)),{loadableGenerated:{webpack:()=>[4360]},ssr:!1});function S(){let e=(0,g.useRouter)(),a=new u.x,[t,r]=(0,n.useState)(null),[h,x]=(0,n.useState)(null),[S,b]=(0,n.useState)([]),[N,y]=(0,n.useState)(!1),[w,k]=(0,n.useState)(!1),[C,D]=(0,n.useState)(0),[P,T]=(0,n.useState)(0),[E,F]=(0,n.useState)({width:0,height:0}),[R,A]=(0,n.useState)(!1),[M,z]=(0,n.useState)(0),[I,_]=(0,n.useState)(0),[B,K]=(0,n.useState)(200),[O,Y]=(0,n.useState)(100),[J,L]=(0,n.useState)(""),[V,$]=(0,n.useState)(""),H=async e=>{var a;let t=null==(a=e.target.files)?void 0:a[0];if(!t||"application/pdf"!==t.type)return void alert("Mohon unggah file PDF!");try{k(!0);let e=await t.arrayBuffer();console.log("buffer",e),r(e),x(t),y(!0)}catch(e){console.error("Error uploading file:",e)}finally{k(!1)}};async function U(t){if(!h&&"send"!==t)return void m().fire("Error","Please upload a PDF document","error");try{if(!(await m().fire({title:"Are you sure?",text:"draft"===t?"You are about to save this document as a draft.":"sign"===t?"You are about to sign this document.":"You are about to send this document.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, ".concat(t,"!")})).isConfirmed)return;if(k(!0),"sign"===t&&!J)return void m().fire("Validation Error","Please fill in the reason field.","error");if("send"===t&&!V)return void m().fire("Validation Error","Please provide recipient and description.","error");try{let s=new FormData;h&&s.append("Document",h),J&&s.append("Reason",J),V&&s.append("SendToNpp",V),"sign"===t?(s.append("Xloc",Math.round(M).toString()),s.append("Yloc",Math.round(I).toString()),s.append("Size",B.toString()),s.append("PageNumber",C.toString()),s.append("IsDraft","false")):s.append("IsDraft","draft"===t?"true":"false");let n=await a.signCertified(s);m().fire("Success",n.data.data.message||"Operation completed","success").then(()=>{e.push("/documents")})}catch(e){console.error(e),m().fire("Error","Something went wrong. Please try again.","error")}}catch(e){console.error("Error during submission:",e)}finally{k(!1)}}return(0,n.useEffect)(()=>{(async()=>{b((await a.getListPegawai()).data.data.filter(e=>"ADMINISTRATOR"!==e.nama))})()},[]),(0,s.jsxs)(c.e7,{breadcrumb:{parent:{name:"Dashboard"},current:"Dokumen"},createButtonText:"Create Document",isCreate:!0,children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-4",children:[(0,s.jsx)("div",{className:"md:col-span-7 col-span-12 relative p-4 min-h-[calc(100vh-100px)] bg-gray-200",children:t?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"flex items-center mb-2",children:(0,s.jsx)("select",{className:"p-2 border rounded",onChange:e=>D(+e.target.value),value:C,children:Array.from({length:P},(e,a)=>(0,s.jsxs)("option",{value:a,children:["Halaman ",a+1]},a))})}),(0,s.jsxs)("div",{className:"relative border",style:{width:"fit-content"},children:[(0,s.jsx)(v,{fileBuffer:t,currentPage:C,onLoad:T,onPageSize:F,signatureURL:"",position:{x:M,y:I},sigSize:{w:B,h:O},onRenderScaleChange:()=>{}}),R&&(0,s.jsx)(l.p,{bounds:"parent",default:{x:E.height/2-450,y:E.height/2,width:B,height:O},onDragStop:(e,a)=>{z(a.x),_(a.y)},onResizeStop:(e,a,t,s,n)=>{K(t.offsetWidth),Y(t.offsetHeight),z(n.x),_(n.y)},className:"z-50",children:(0,s.jsx)("div",{className:"w-full h-full border-2 border-blue-500 bg-white/40 rounded-md flex items-center justify-center text-sm text-blue-700 font-semibold",children:"Signature"})})]})]}):(0,s.jsx)("div",{className:"flex justify-center items-center w-full h-full",children:(0,s.jsx)("h4",{className:"text-center",children:"Dokumen akan ditampilkan di sini"})})}),(0,s.jsx)("div",{className:"md:col-span-5 col-span-12 px-4",children:(0,s.jsxs)("div",{className:"space-y-4 w-full max-w-sm",children:[(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(o.J,{htmlFor:"upload-pdf",children:"Unggah Dokumen PDF"}),(0,s.jsx)(i.p,{id:"upload-pdf",type:"file",accept:"application/pdf",onChange:H,className:"cursor-pointer"})]}),N&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)(d.S,{id:"terms-2",checked:R,onCheckedChange:e=>A(!!e)}),(0,s.jsxs)("div",{className:"grid gap-1",children:[(0,s.jsx)(o.J,{htmlFor:"terms-2",className:"font-medium",children:"Tanda Tangan Digital"}),(0,s.jsx)("p",{className:"text-muted-foreground text-sm",children:"Centang untuk menampilkan kolom tanda tangan di atas dokumen sebagai verifikasi digital."})]})]}),!R&&(0,s.jsxs)("div",{className:"grid gap-2 mt-3",children:[(0,s.jsx)(o.J,{htmlFor:"signature-desc",children:"Konfirmasi Tanda Tangan"}),(0,s.jsx)(j,{data:S,labelKey:"nama",valueKey:"npp",filterKey:"nama",filterExclude:"ADMINISTRATOR",placeholder:"Pilih Pegawai",onChange:e=>{$(e)}})]}),(0,s.jsxs)("div",{className:"grid gap-2 mt-3",children:[(0,s.jsx)(o.J,{htmlFor:"signature-desc",children:"Konfirmasi Tanda Tangan"}),(0,s.jsx)(i.p,{id:"signature-desc",type:"text",placeholder:"Masukkan deskripsi",value:J,onChange:e=>L(e.target.value)})]})]}),N&&(0,s.jsx)(s.Fragment,{children:R?(0,s.jsx)(f.$,{variant:"default",onClick:()=>{U("sign")},children:"Sign"}):(0,s.jsx)(f.$,{variant:"default",onClick:()=>{U("send")},children:"Send"})}),N&&(0,s.jsx)(f.$,{className:"ml-3",variant:"default",onClick:()=>{U("draft")},children:"Draft"})]})})]}),w&&(0,s.jsx)("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"flex flex-col items-center gap-2 bg-white p-6 rounded-xl shadow-lg",children:[(0,s.jsx)(p.A,{className:"h-6 w-6 animate-spin text-primary"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Memproses data..."})]})})]})}},1649:(e,a,t)=>{Promise.resolve().then(t.bind(t,829))}},e=>{var a=a=>e(e.s=a);e.O(0,[825,592,320,352,134,452,794,766,534,246,7,139,614,215,441,684,358],()=>a(1649)),_N_E=e.O()}]);