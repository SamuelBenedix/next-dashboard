(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[651],{5025:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>f});var n=t(5155),s=t(2115),r=t(5028),i=t(2523),l=t(5617),d=t(5057),o=t(4991),c=t(4831),u=t(4752),p=t.n(u),m=t(285),h=t(5695),g=t(1154);t(8851),t(2465);let x=(0,r.default)(()=>Promise.all([t.e(464),t.e(360)]).then(t.bind(t,4360)),{loadableGenerated:{webpack:()=>[4360]},ssr:!1});function f(){let e=(0,h.useRouter)(),{id:a}=(0,h.useParams)(),t=new c.x,r="string"==typeof a?a:"",[u,f]=(0,s.useState)(null),[j,b]=(0,s.useState)(0),[v,w]=(0,s.useState)(0),[y,N]=(0,s.useState)(""),[S,k]=(0,s.useState)(""),[C,D]=(0,s.useState)(100),[F,P]=(0,s.useState)(100),[E,M]=(0,s.useState)(120),[z,T]=(0,s.useState)(80),[_,A]=(0,s.useState)(null),[B,R]=(0,s.useState)(!1);(0,s.useEffect)(()=>{r&&(async()=>{R(!0);try{let e=new FormData;e.append("idFile",r);let a=await t.downloadCertified(e),n=a.data,s=new Blob([n],{type:"application/pdf"}),i=new File([s],"document.pdf",{type:"application/pdf"});A(i),f(a.data)}catch(e){console.error("Failed to load PDF:",e),p().fire("Error","Gagal memuat dokumen","error")}finally{R(!1)}})()},[r]);let Y=async n=>{if(!a||!(await p().fire({title:"Are you sure?",text:"sign"===n?"You are about to sign this document?":"You are about to reject this document?",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, ".concat(n," it!")})).isConfirmed)return;let s=new FormData;_&&s.append("Document",_),s.append("idFile",a),s.append("reason",S),s.append("keterangan",y),s.append("IsDraft","false"),s.append("IsApprove","sign"===n?"true":"false"),"sign"===n&&(s.append("Xloc",Math.round(C).toString()),s.append("Yloc",Math.round(F).toString()),s.append("Size",(E-10).toString()),s.append("PageNumber",v.toString()),s.append("SendToNpp",""));try{R(!0);let a=await t.signCertified(s);p().fire("Validation Success",a.data.data.message,"success").then(()=>{e.push("/documents")})}catch(e){console.error("Error processing document:",e),p().fire("Error","Failed to ".concat(n," document"),"error")}finally{R(!1)}};return(0,n.jsxs)(o.e7,{breadcrumb:{parent:{name:"Dashboard"},current:"Dokumen"},createButtonText:"Create Document",isCreate:!0,children:[(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-4",children:[(0,n.jsx)("div",{className:"md:col-span-7 col-span-12 relative p-4 min-h-[calc(100vh-100px)] bg-gray-200",children:u?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"flex items-center mb-2",children:(0,n.jsx)("select",{className:"p-2 border rounded",onChange:e=>w(Number(e.target.value)),value:v,children:Array.from({length:j},(e,a)=>(0,n.jsxs)("option",{value:a+1,children:["Halaman ",a+1]},a))})}),(0,n.jsxs)("div",{className:"relative border",style:{width:"fit-content"},children:[(0,n.jsx)(x,{fileBuffer:u,currentPage:v,onLoad:b,onPageSize:()=>{},signatureURL:"",position:{x:C,y:F},sigSize:{w:E,h:z},onRenderScaleChange:()=>{}}),(0,n.jsx)(l.p,{bounds:"parent",default:{x:C,y:F,width:E,height:z},onDragStop:(e,a)=>{D(a.x),P(a.y)},onResizeStop:(e,a,t,n,s)=>{M(t.offsetWidth),T(t.offsetHeight),D(s.x),P(s.y)},className:"z-50",children:(0,n.jsx)("div",{className:"w-full h-full border-2 border-blue-500 bg-white/40 rounded-md flex items-center justify-center text-sm text-blue-700 font-semibold",children:"Signature"})})]})]}):(0,n.jsx)("div",{className:"flex justify-center items-center w-full h-full",children:(0,n.jsx)("h4",{className:"text-center",children:"Dokumen akan ditampilkan di sini"})})}),(0,n.jsx)("div",{className:"md:col-span-5 col-span-12 px-4",children:(0,n.jsxs)("div",{className:"space-y-4 w-full max-w-sm",children:[(0,n.jsxs)("div",{className:"grid gap-2 mt-3",children:[(0,n.jsx)(d.J,{htmlFor:"signature-desc",children:"Keterangan Tambahan"}),(0,n.jsx)(i.p,{id:"signature-desc",type:"text",placeholder:"Masukkan keterangan tambahan",value:y,onChange:e=>N(e.target.value)})]}),(0,n.jsxs)("div",{className:"grid gap-2 mt-3",children:[(0,n.jsx)(d.J,{htmlFor:"signature-reason",children:"Alasan Penandatanganan"}),(0,n.jsx)(i.p,{id:"signature-reason",type:"text",placeholder:"Masukkan alasan penandatanganan",value:S,onChange:e=>k(e.target.value)})]}),(0,n.jsx)(m.$,{onClick:()=>Y("sign"),children:B?"Memproses...":"Tandatangani Dokumen"}),(0,n.jsx)(m.$,{className:"ml-3",variant:"destructive",onClick:()=>Y("reject"),children:B?"Memproses...":"Tolak Dokumen"})]})})]}),B&&(0,n.jsx)("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"flex flex-col items-center gap-2 bg-white p-6 rounded-xl shadow-lg",children:[(0,n.jsx)(g.A,{className:"h-6 w-6 animate-spin text-primary"}),(0,n.jsx)("p",{className:"text-sm text-muted-foreground",children:"Memproses data..."})]})})]})}},8252:(e,a,t)=>{Promise.resolve().then(t.bind(t,5025))}},e=>{var a=a=>e(e.s=a);e.O(0,[825,592,320,352,134,452,794,766,534,246,7,139,614,215,441,684,358],()=>a(8252)),_N_E=e.O()}]);